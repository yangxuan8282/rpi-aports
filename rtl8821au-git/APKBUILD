# Maintainer: He Yangxuan <yangxuan8282@gmail.com>
pkgname=rtl8821au-git
pkgver=4.3.14
pkgrel=1
pkgdesc="Realtek 8812AU USB WiFi driver"
url="https://github.com/diederikdehaas/rtl8812AU"
arch="armhf"
license="GPL2"
makedepends="linux-rpi2-dev"
install="$pkgname.post-install"
source="$pkgname-$pkgver.tar.gz::$url/archive/driver-4.3.14.tar.gz
	$install"
options="!check"
_kver=4.9.76-0-rpi2
_builddir=${srcdir}/rtl8812AU-driver-4.3.14

build() {
	cd $_builddir

	sed -i 's/CONFIG_RTL8812A = y/CONFIG_RTL8812A = n/' Makefile
	sed -i 's/CONFIG_RTL8821A = n/CONFIG_RTL8821A = y/' Makefile

	sed -i 's/CONFIG_PLATFORM_I386_PC = y/CONFIG_PLATFORM_I386_PC = n/' Makefile
	sed -i 's/CONFIG_PLATFORM_ARM_RPI = n/CONFIG_PLATFORM_ARM_RPI = y/' Makefile

	KVER=${_kver} make
}

package() {
	cd $_builddir
	
	install -Dm644 8821au.ko "${pkgdir}/lib/modules/${_kver}/kernel/drivers/net/wireless/8821au.ko"
}

sha512sums="444cc4f91783e0cbb42ec241f71d3bade4362028e4627d5448e59b8ac622a7f7bb51fe630d258d440b480794a24b1434f23efb32e693e6beaed9f5155c7799eb  rtl8821au-git-4.3.14.tar.gz
3d0ecfea8348729b0f718a66ffde85783f2e1383fc000059fb4b5ef75d705d99ecf2a2b5a1c4550ef9aa50073b7dac4fe86ac4602ca4bf4430d1dc6d97f22241  rtl8821au-git.post-install"
